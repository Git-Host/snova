#summary C4 Plugin在Appfog上的部署配置说明.
#labels Featured

= Step 1: 准备Heroku Client环境 =
按照Appfog注册账号，并按照官方的[https://docs.appfog.com/getting-started/af-cli AF Command Line Tool]下载安装appfog的命令行工具。

= Step 2: 部署Snova C4的服务端到Appfog =
  * 下载`snova-c4-server-[version].war`， 放在任意地方
  * 在命令行下war文件所在目录，依次顺序执行以下的命令,每一行单独执行
    {{{
       af login
       af push <appname> --path ./snova-c4-server-0.19.0.war  
    }}}
  * 执行af push命令后会出现下面输出，参考下面输入选择（注意， appname用xxx代替了）
     {{{
       Detected a Java Web Application, is this correct? [Yn]: Y
      1: AWS US East - Virginia
      2: AWS EU West - Ireland
      3: AWS Asia SE - Singapore
      4: Rackspace AZ 1 - Dallas
      5: HP AZ 2 - Las Vegas
      Select Infrastructure: 3
      Application Deployed URL [xxx.ap01.aws.af.cm]: 
      Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
      How many instances? [1]: 
      Create services to bind to 'snova'? [yN]: n
      Would you like to save this configuration? [yN]: n
      Creating Application: OK
       Uploading Application:
       Checking for available resources: OK
       Processing resources: OK
       Packing application: OK
       Uploading (3K): OK   
       Push Status: OK
       Staging Application 'xxx': OK                                                 
       Starting Application 'xxx': OK 
     }}}
  * 留意执行“af push”时的输出，出现 Application Deployed URL的一行中含部署后的app的域名，记住次域名，用于配置C4。例如：
    {{{
        Application Deployed URL [xxx.ap01.aws.af.cm]: 
        其中xxx.ap01.aws.af.cm即为域名
    }}}
    
= Step 3: 配置客户端 =
客户端可选gsnova(Go)或者snova(Java)
==gsnova(Go)==
  * 修改gsnova.conf中C4部分，填入之前创建的域名，重启gsnova生效
    {{{
     [C4]
     #Enable改为1，C4才能生效，默认为0关闭
     Enable=1
     #修改domain为Step2创建的域名, 可加多个域名
     WorkerNode[0]=xyz.herokuapp.com
     WorkerNode[1]=xyz.cloudfoundry.com
    }}}
  * 修改gsnova.conf中SPAC下默认的Proxy实现为C4
    {{{    
     [SPAC]
     Enable=1
     #默认Proxy实现，初始为GAE
     Default=C4
    }}}
==snova(Java)==
  * 从snova-0.12.0120开始自动集成c4 plugin，无需单独安装
  * 修改`<snova>/plugins/c4/conf/c4-client.conf`
    {{{
       [C4]
       #修改domain为Step2创建的域名, 可加多个域名
       WorkerNode[0]=xyz.herokuapp.com
       WorkerNode[1]=xyz.cloudfoundry.com
    }}}
  * 修改`<snova>/conf/snova.conf`，将C4改为默认proxy实现(可选)
   {{{
      [Framework]
      .........
      ##Can choose in plugins, default is GAE
      ProxyService=C4
    }}}

= Step 5: 与SPAC集成（可选） =
  * 参考SPAC的说明[http://code.google.com/p/snova/wiki/SpecialProxyAutoConfig SpecialProxyAutoConfig]修改`SelectProxy`方法打造自己的proxy环境
  