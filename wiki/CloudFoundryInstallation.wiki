#summary C4 Plugin在CloundFoundry上的部署配置说明.
#labels Featured,Phase-Support

= Step 1: 注册`CloundFoundry`环境 =
到官方链接[https://my.cloudfoundry.com/signup CloundFoundry]注册帐号， 注意，注册不是马上成功，一般第二天才会收到注册成功的邮件，其中包含用户名密码

= Step 2: 安装`CloundFoundry`部署工具 =
  * 参考官方说明安装命令行工具vmc，注意安装依赖ruby以及gem的安装，   [http://start.cloudfoundry.com/tools/vmc/installing-vmc.html  vmc安装]
  * 注意，gem安装vmc时可能会被防火墙中断，可能需要设置代理，代理可以用snova设置，如
   {{{
       gem install --http-proxy http://127.0.0.1:48100 vmc 
   }}}

= Step 3: 部署服务到`CloundFoundry` =
  * 将`snova-c4-server-[version].war`放到任意的空目录下，然后在命令行下进入该目录，逐个执行下面的三行命令
    {{{
       vmc target api.cloudfoundry.com
       vmc login
       vmc push <appname>  —— 此处appname为任意名称，为域名一部分，此命令执行后有类似下面的交互内容，参照下面的输入Y/N
        Would you like to deploy from the current directory? [Yn]: Y
        Application Deployed URL [<appname>.cloudfoundry.com]: <回车>
        Detected a Java Web Application, is this correct? [Yn]: Y
        Memory Reservation (64M, 128M, 256M, 512M, 1G, 2G) [512M]:   <回车>
        Creating Application: OK
        Would you like to bind any services to '<appname>'? [yN]: n
        Uploading Application:
        Checking for available resources: OK
        Processing resources: OK
        Packing application: OK
        Uploading (843K): OK
        Push Status: OK
        Staging Application: OK
        Starting Application: OK

    }}}
 * 浏览器中输入`<appname>.cloundfoundry.com`， 查看是否部署成功，否则检查上述步骤是否执行成功

= Step 4: 配置Snova C4 Plugin的客户端 =
  * 从snova-0.12.0120开始自动集成c4 plugin，无需单独安装
  * 修改`<snova>/plugins/c4/conf/c4-client.conf`
    {{{
       [C4]
	   #修改domain为Step2创建的域名, 可加多个域名
       WorkerNode[0]=xyz.herokuapp.com
       WorkerNode[1]=xyz.cloudfoundry.com
    }}}
  * 修改`<snova>/conf/snova.conf`，将C4改为默认proxy实现(可选)
    {{{
      [Framework]
      .........
      ##Can choose in plugins, default is GAE
      ProxyService=C4
    }}}

= Step 5: 与SPAC集成（可选） =
  * 在SPAC的解释语言中，c4被定义为$C4="C4"
  * 参考SPAC的说明[http://code.google.com/p/snova/wiki/SpecialProxyAutoConfig SpecialProxyAutoConfig]修改`SelectProxy`方法打造自己的proxy环境