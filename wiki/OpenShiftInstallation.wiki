#summary C4 Plugin在OpenShift上的部署配置说明.
#labels Featured,Phase-Support

= Step 1: 注册`OpenShift`环境 =
到官方链接[https://openshift.redhat.com OpenShift注册]注册帐号

= Step 2: 安装`OpenShift`部署工具 =
  * 参考官方说明安装命令行工具rhc，注意安装依赖ruby以及gem的安装，   [https://openshift.redhat.com/app/express#quickstart  rhc安装]
  * 注意，gem安装rhc时可能会被防火墙中断，可能需要设置代理，代理可以用snova设置，如
   {{{
       gem install --http-proxy http://127.0.0.1:48100 rhc 
   }}}

= Step 3: 部署服务到`OpenShift` =
  * 将`snova-c4-server-[version].war`放到任意的空目录下，然后在命令行下进入该目录，逐个执行下面的命令
    {{{
rhc setup        --登录
rhc-create-domain -n <domainName>  --创建主域名， 部署新应用是这一步可不执行
rhc-create-app -a <appname> -t jbossews-1.0  --创建app,执行后会在当前目录下创建一个appname的目录名；注意保留此目录用于以后更新

cd <appname>
mv snova-c4-server-[version].war deployments/ROOT.war
--上一步将snova-c4-server-[version].war改名为ROOT.war, 移动到deployments目录下， windows用户参考说明操作 

git rm -r src pom.xml   此步重新部署同一个app时可不执行
git add .
git commit –m “deploy”
git push

    }}}
 * 浏览器中输入`<appname>-<domainName>.rhcloud.com`， 查看是否部署成功，否则检查上述步骤是否执行成功

= Step 4: 配置客户端 =
客户端可选gsnova(Go)或者snova(Java)
==gsnova(Go)==
  * 修改gsnova.conf中C4部分，填入之前创建的域名，重启gsnova生效
    {{{
     [C4]
     #Enable改为1，C4才能生效，默认为0关闭
     Enable=1
     #修改domain为Step2创建的域名, 可加多个域名
     WorkerNode[0]=xyz.herokuapp.com
     WorkerNode[1]=xyz.cloudfoundry.com
    }}}
  * 修改gsnova.conf中SPAC下默认的Proxy实现为C4
    {{{    
     [SPAC]
     Enable=1
     #默认Proxy实现，初始为GAE
     Default=C4
    }}}
==snova(Java)==
  * 从snova-0.12.0120开始自动集成c4 plugin，无需单独安装
  * 修改`<snova>/plugins/c4/conf/c4-client.conf`
    {{{
       [C4]
       #修改domain为之前创建的域名, 可加多个域名
       WorkerNode[0]=xyz.herokuapp.com
       WorkerNode[1]=xyz.cloudfoundry.com
    }}}
  * 修改`<snova>/conf/snova.xml`，将C4改为默认proxy实现(可选)
    {{{
      [Framework]
      .........
      ##Can choose in plugins, default is GAE
      ProxyService=C4
    }}}

= Step 5: 与SPAC集成（可选） =
  * 在SPAC的解释语言中，c4被定义为$C4="C4"
  * 参考SPAC的说明[http://code.google.com/p/snova/wiki/SpecialProxyAutoConfig SpecialProxyAutoConfig]修改`SelectProxy`方法打造自己的proxy环境