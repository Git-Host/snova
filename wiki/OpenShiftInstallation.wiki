#summary C4 Plugin在OpenShift上的部署配置说明.
#labels Featured,Phase-Support

= Step 1: 注册`OpenShift`环境 =
到官方链接[https://openshift.redhat.com OpenShift注册]注册帐号

= Step 2: 安装`OpenShift`部署工具 =
  * 参考官方说明安装命令行工具rhc，注意安装依赖ruby以及gem的安装，   [https://openshift.redhat.com/app/express#quickstart  rhc安装]
  * 注意，gem安装rhc时可能会被防火墙中断，可能需要设置代理，代理可以用snova设置，如
   {{{
       gem install --http-proxy http://127.0.0.1:48100 rhc 
   }}}

= Step 3: 部署服务到`OpenShift` =
  * 将`snova-c4-server-[version].war`放到任意的空目录下，然后在命令行下进入该目录，逐个执行下面的命令
    {{{
      rhc-create-domain -n <domainName> -l <yourId> -p <yourPassword>  创建主域名， 部署新应用是这一步可不执行
      rhc-create-app -a <appName> -t jbossas-7.0 -p <yourPassword>  创建app
      cd <appName>
      mv ../snova-c4-server-[version].war <appName>/deployments/ROOT.war
      git rm -r src pom.xml
      git commit –m “delete”
      git push                         以上三步重新部署同一个app时可不执行
      git init 
      git add .
      git commit –m “deploy”
      git push

    }}}
 * 浏览器中输入`<yourdomain>.rhcloud.com`， 查看是否部署成功，否则检查上述步骤是否执行成功

= Step 4: 配置Snova C4 Plugin的客户端 =
  * 从snova-0.12.0120开始自动集成c4 plugin，无需单独安装
  * 修改`<snova>/plugins/c4/conf/c4-client.xml`
    {{{
       <!--修改domain为Step2创建的域名, 可加多个域名-->
       <WorkerNode domain="xyz.herokuapp.com" /> 
    }}}
  * 修改`<snova>/conf/snova.xml`，将heroku改为默认proxy实现(可选)
   {{{
       <!--修改Proxy实现为C4， 默认为GAE-->
       <ProxyEventHandler>C4</ProxyEventHandler>
    }}}

= Step 4: 与SPAC集成（可选） =
  * 在SPAC的解释语言中，c4被定义为$C4="C4"
  * 参考SPAC的说明[http://code.google.com/p/snova/wiki/SpecialProxyAutoConfig SpecialProxyAutoConfig]修改`SelectProxy`方法打造自己的proxy环境